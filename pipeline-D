@Library('sharedlibs') _

pipeline {
    agent any
    
    tools {
  maven 'maven3.8.6'
}

/*
triggers {
  pollSCM ('* * * * *')
}
*/
options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '4', daysToKeepStr: '', numToKeepStr: '4')
  timestamps ()
}
    
    stages {
        // Check Out code stage
        stage ('Check Out code'){
            steps {
                sendslacknotifications("STARTED")
                git branch: 'development', credentialsId: 'c909c5f3-aa38-4781-b123-659ff2120203', url: 'https://github.com/praveen-devops-batch/maven-web-application.git'
                
            }
        }
        // Build the package
       stage('Build') {
           steps {
               sh "mvn clean package"
           }
       }
       
       /*
       //Execute SonarQube report
       stage('Execute SonarQube Report'){
           steps {
               sh "mvn sonar:sonar"
           }
       }
       
       // Dploy Artifact into Artifact repository
       stage('Deploy Artifact Into Artifact Repository'){
           steps {
               sh "mvn deploy"
           }
       }
       // Deploy App Into TomCat Server
       stage('Deploy Application Into Tomcat Server'){
           steps{
              sshagent(['1acfa138-ce2b-48d0-bf02-3a17ad7896e0']) {
              sh "scp -o StrictHostKeyChecking=no  target/maven-web-application.war ec2-user@172.31.15.253:/opt/apache-tomcat-9.0.64/webapps"
} 
               
           }
       }
       */
       
    }//stages closing tag
    
    post {
  success {
    sendslacknotifications("SUCCESS")
  }
  failure {
    sendslacknotifications("FAILURE")
  }
}
}// pipeline closing tag

/*

//Below Code is send the Build Notifications 
def sendslacknotifications(String buildStatus = 'STARTED') {
  // build status of null means successful
  buildStatus =  buildStatus ?: 'SUCCESS'

  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"

  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESS') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }

  // Send notifications
  slackSend (color: colorCode, message: summary)
}
*/
